<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Músicas</title>
  <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='logo.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
  <meta name="theme-color" content="#111111">
  <meta name="apple-mobile-web-app-status-bar-style" content="#111111">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;
  500;
  700&display=swap" rel="stylesheet">
</head>

<body>
  <header class="topbar">
    <div class="breadcrumb">
      <a href="{{ url_for('home') }}">Início</a>
      / Músicas
    </div>
    <h1 class="title">Minhas Músicas</h1>
    <form class="controls" method="get" action="{{ url_for('musicas') }}" role="search">
      <input type="text" name="q" placeholder="Pesquisar por nome..." value="{{ q }}" aria-label="Pesquisar" />
      <select name="metodo" aria-label="Método de busca">
        <option value="linear"
        {% if metodo=='linear' %}selected{% endif %}
        >Busca Linear (substring)</option>
        <option value="binaria" {% if metodo=='binaria' %}selected{% endif %}>Busca Binária (substring)</option>
      </select>
      <select name="ordenacao" aria-label="Ordenação">
        <option value="nome_asc" {% if ordenacao=='nome_asc' %}selected{% endif %}>Nome A→Z</option>
        <option value="nome_desc" {% if ordenacao=='nome_desc' %}selected{% endif %}>Nome Z→A</option>
      </select>
      <button class="btn" type="submit">Aplicar</button>
      {% if q or metodo!='linear' or ordenacao!='nome_asc'
      %} <a class="btn" style="background:#ddd;color:#333;border:1px solid #666;" href="{{ url_for('musicas') }}"
        aria-label="Limpar filtros">Limpar</a> {% endif %} </form>
    <p class="hint">Resultados: <strong>{{ total }}</strong>{% if q %} • termo: <em>"{{ q }}"</em>{% endif %}</p>
  </header>
  <main>
    <section class="grid"> {% if musicas and musicas|length > 0 %} {% for musica in musicas %}
      <article class="card" data-src="{{ url_for('static', filename=musica.caminho_arquivo) }}"
        data-nome="{{ musica.nome }}" data-artista="{{ musica.artista }}"> {% if musica.capa %} <img
          src="{{ url_for('static', filename=musica.capa) }}" alt="Capa: {{ musica.nome }}" class="album-cover" /> {%
        else %} <div class="cover-placeholder">SEM CAPA</div> {% endif %} <div class="card-body">
          <h3>{{ musica.nome }}</h3>
          <p>{{ musica.artista }}</p>
        </div>
      </article> {% endfor %} {% else %} <div class="empty">Nenhuma música encontrada.</div> {% endif %}
    </section>
  </main> <!-- Global Player -->
  <div class="player"> <button id="playPause">▶</button>
    <div class="track-info"> <strong id="trackTitle">Nenhuma música</strong> <span id="trackArtist"></span> </div>
    <input type="range" id="progress" value="0" min="0" max="100"> <audio id="audio"></audio>
  </div>
  <script>
    const cards = document.querySelectorAll('.card');

    const audio = document.getElementById('audio');

    const playPause = document.getElementById('playPause');

    const trackTitle = document.getElementById('trackTitle');
    const trackArtist = document.getElementById('trackArtist');
    const progress = document.getElementById('progress');
    let currentTrack = null;

    cards.forEach(card => {
      card.addEventListener('click', () => {
        const src = card.dataset.src;
        const nome = card.dataset.nome;
        const artista = card.dataset.artista;
        if (currentTrack !== src) {
          currentTrack = src;
          audio.src = src;
          trackTitle.textContent = nome;
          trackArtist.textContent = artista;
          audio.play();
          playPause.textContent = "⏸";

        }
      });
    });
    playPause.addEventListener('click', () => {
      if (audio.src) {
        if (audio.paused) {
          audio.play();
          playPause.textContent = "⏸";

        } else {
          audio.pause();
          playPause.textContent = "▶";
        }
      }
    });
    audio.addEventListener('timeupdate', () => {
      progress.value = (audio.currentTime / audio.duration) * 100 || 0;
    });
    progress.addEventListener('input', () => {
      if (audio.duration) {
        audio.currentTime = (progress.value / 100) * audio.duration;
      }
    });
  </script>
</body>

</html>